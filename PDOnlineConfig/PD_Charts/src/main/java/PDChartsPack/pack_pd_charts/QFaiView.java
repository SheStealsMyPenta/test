/*
*                _.'__    `.
             .--(#)(##)---/#\
           .' @          /###\
           :         ,   #####
            `-..__.-' _.-\###/
                  `;_:    `"'
                .'"""""`.
               /,  野比 ,\
              //  很穷!  \\
              `-._______.-'
              ___`. | .'___
             (______|______)

                                           `.:;=ioO8E#E######EOo=;~``
                                    .I+O#MMMMMMMMMMMMMMMMMMMMMMMMMMMMMEoI~
                               `;oEMMMMMMMM##EEEEEEEEEEEEEEEEEEEEE###MMMMMMEoI`
                            ~+#MMMMM##EEEEEEEEEEEEEEE##EEEEEEEEEEEEEEEEEE##MMMMMo;`
                         `i#MMMM#EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE#MMMM#i.
                       .8MMMM#EEEEEEEE#EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE#MMMM#=
                     =#MMM#EEEE#EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE#MMMMI
                   =MMMMEEE#EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEMMM#I
                 :#MMMEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE#MMME.
               .8MMMEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEMM#E#MMMi
              =MMM#EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE#EE#M#EEMMM8`
             +MMM#E#EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE#EEE#M#EE#MM#.
            +MMMEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE#EMM#EE#MMM.
           iMMM#EEEEEEEEEEEEEEEEEE##EEEEEEE#EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE#EEMM#EE#MM#`
          :MMM#EEEEEEEEEEEEEEEEEE#MMEEEEEEEEEEEEEE######MMMMMMMMMMM#MM#######EEEEEEEEEE##E#MMEEE#MME`
          EMM#E#EEEEEEEEEEEEEE#EEMM#EEEE##MMMMMMMMMMMMMM###EEE88EEEEE##MMMMMMMMMMMM##EEEEEEMM#EEE#MMo
         IMMMEE#EEEEEEEEEEEEE#EE#MMMMMMMM#EO+=I:~.``                        `.~;=+8#MMMM#EE#MMEE#E#MMI
         OMM#E#EEEEEEEEEEEEEEEEE#MMo=:~`                                             .oMMMMMMMEE#EEMMM~
        `#MM#E#EEEEEEEEEEEEEEEEE#ME                                    `:io+=I:.      =MMEE#MMEEEEE#MMO
        ~MMMEE#EEEEEEEEEEEEEEEEEMM8                `~I+oO8E#MMM8I.     `;+O8EOoiI~``  iMMEEEEEEEEEEEMMM;
        ~MMMEE#EEEEEEEEEEEEEEEEEMME              `IOEE8o++O8888EEOI.  `.:=I~          =MMEEEEEEEEEEEEMMO
        `EMMEE#EEEEEEEEEEEEEEEEEMME`            ```        `...;=iI.  ```~;:;I==:     IMM#EE#EEEEEEEE#M#.
         oMMEEEEEEEEEEEEEEEEEEEE#MM:             `.;+8#MMMMM#O~          ~:;OM8+I~`   .MM#EE#EEEEEMM#EMM=
         iMM#EE##EEEEEEEEEEE#EEE#MM=              .::.`.:~`                 .~~~`      8MMEE#EEEEEMMM#MM+
         ;MM#EE#EEEEEEEEEEEEEEEE#MME`                           `                      ;MM#EEEEEEE#MMMMM+
         `EMMEEEEEEEEEEEEEEEEEEE#MMM~                        ~I:.          `:I;.        ;MM##MMMMMMMMiEM:
          :MM#EMMEEEEEEEEEEEEEEEE#MMI                      `iEo:`.:;I====::;~~oMo.       ~MMMEEEEOo+;
           IMM#MMMEEEEEEEEEEE##MMMMMO                      .` ~+#MMMMMMMMEO+:  `~~        .#M8
            .EMM#8MMMMMMMMMMMMMM#8o=`                              ````.`                  .MMO
              :o=`+Ooo+#MMEI;~`                                `:io88E#E88E#E+~             oMM;      `.~:~~~~~.``
                       ~MMM;                                  ~EMM8+=;:;I=OMMME~            =MMi  `iEMMMMMMMMMMMMMMMMO
                        ~MMM=                                 ~O#Ei==iiii=II=:              +MM= oMMMOI~...``i8#MMM8=
                         `8MM8.                                 :~           `             ~MM#.8MME`        +MM;
                           =MMMO;                              `I8MMME8Ooo+=:`            +MM#=EMMo         `#MM.
                            `oMMMMo:                               `.;I=+=~`           ~oMMM8OMMM;     :=. ;#MM=
                               ;OMMMMEi:.                                         `:iEMMMMoiEMM8`     ~MMMMMM#;
                                  :i8MMMMMM#8o+=;~.`                      `.;I+O#MMMMMMo:`oMMMI      `#MM~..`
                                       iMMMMMMMMMMMMMMMM#E888OOOOO88E##MMMMMMMMMMM#+~   ;MMME`      `MMM.
                                     ;#MMMi.~:~=MME8#MME###MMMMMMMMMMMMME88ooi+8MMMMEi~oMMM+       `MMM.
                                   :#MMM+.;i~~~IMMO+OMMI`...~~::~;MM8+#M8`...~~..:i8MMMMMM;       .MMM.
                                 `8MMMo..;MM~~~IMMO+OMMi.~~~~~~~~.OM#+8MM;+#;~~~~~~..iMMM;        #MM:
                                ~MMM#;.~~#M+.~~IMM8+oMMi.~~~~~~~~~IMMOoMMoiM+.~~~~~:~IMME        EMM;
                               =MMMo.~~.oMM~~~~IMM8ooMMo.~~~~~~~~~~#ME+EM#IM#.~~~~~~~IMM#       EMM;
                              oMMMi.~:.IMMo.~~~IMMO+oMMO.:~~~~~~~~.8M#+OMMIEM=.~~~~~~;MME     `#MM;
                             oMMMI.~:~~EMM;.~:~=MMO+oMMo.~~~~~~~~~.oMMooMMioMM;.~~~~~:MM8    :MMM~
                            oMMMI.~~~.IMM8~~~~~iMMOooMMo.~~~~~~~~~.iMM8+#M8IMMM#I.~~~:MM#.`~8MM#.
                           ~MMM;~~:~~.OMMi.~~~.OMMoooMMo.~~~~~~~~~~;MME+8M#:EMMMM#I~~~EMMMMMMMO
                           #MM;.:~:~~:MMM:~::~~#MMOoOMMo~:::::::::~:MMMoOMMI+MM;.oM#~.=MMiII~
                           .;. `````  ```      ````````          `` .~~..~:.`~~.       `
* */

package PDChartsPack.pack_pd_charts;

import android.content.Context;
import android.graphics.Canvas;
import android.graphics.Color;
import android.graphics.Paint;
import android.graphics.Path;
import android.support.annotation.Nullable;
import android.util.AttributeSet;
import android.view.MotionEvent;
import android.view.View;

import java.util.ArrayList;
import java.util.List;

import PDChartsPack.pack_Run_Data_Cash.P_Data;


/**
 * Created by SONG on 2017/10/31 14:17.
 */

public class QFaiView extends View {
    private int COLOR_1 = Color_set.ARROW_Color_1;
    private int COLOR_2 = Color_set.ARROW_Color_2;
    private int COLOR_3 = Color_set.ARROW_Color_3;
    private boolean SHOW_TAB_CAN_TAUCHED = false;

    private String Format = "dB";
    private int SHOW_OFFSET = 0;

    private float touch_start_X;
    private float touch_start_Y;

    private float touch_end_X;
    private float touch_end_Y;
    private int PHASE = 0;
    private int THRESHOLD = 0;


    private int m_ntempPhase = 0;
    private int m_ntempShowTab = 0;
    private int m_ntempThreshold = 0;

    /**
     * 栅格线颜色
     */
    private int GRID_LINE_COLOR = Color_set.Grid_Color;
    /**
     * 坐标轴颜色
     */
    private int AXIS_COLOR = Color_set.TEXT_COLOR;
    /**
     * 数据前景色
     */
    private int DATA_ABOVE_COLOR = Color_set.QFAI_DATA_COLOR;
    /**
     * 数据背景色
     */
    private int DATA_BKG_COLOR = Color_set.DATA_BKG_COLOR;

    /**
     * 背景颜色
     */
    private int BKG_COLOR = Color_set.BKG_COLOR;//Color.LTGRAY;

    /**
     * 显示范围
     */
    private int SHOW_TAB = 80;
    /**
     * 字体大小
     */
    private float TEXT_SIZE = 25;


    /**
     * 数据
     */
    private List<Integer> Data = null;

    private List<P_Data> m_objTempData;

    private int[] DataResult = new int[TheOtherParameter.PHASE_COUNT];

    private float viewStartTop;
    private float viewStartLeft;
    private float viewHight;
    private float viewWidth;
    private float start_x;
    private float start_y;
    private float end_x;
    private float end_y;

    private PrpsListener listenr;
    private float lable_size;

    public QFaiView(Context context) {
        super(context);
    }

    public QFaiView(Context context, @Nullable AttributeSet attrs) {
        super(context, attrs);
    }

    public QFaiView(Context context, @Nullable AttributeSet attrs, int defStyleAttr) {
        super(context, attrs, defStyleAttr);
    }

    @Override
    protected void onDraw(Canvas canvas) {
        super.onDraw(canvas);
        /*设置背景颜色*/
        super.setBackgroundColor(BKG_COLOR);
        Information_Init();
        DrawBackGround(canvas);
        Draw_Title(canvas);
        Draw_Data(canvas);
        Draw_Information(canvas);
        Draw_TriCyle(canvas);
        // DrawData(canvas);
        Draw_Y_Lable(canvas);
    }

    private void Draw_Y_Lable(Canvas canvas) {
        float offset = 0;
        String msg = "幅值(" + Format + ")";

        offset = getTextWidth("000", TEXT_SIZE) + TEXT_SIZE / 2.0f + 15.0f;


        Information_Drawer.Draw_left_Center(canvas, start_x - offset, start_y, (end_y - start_y), msg, TEXT_SIZE);

    }

    private void Information_Init() {
        viewStartTop = super.getTop();
        viewStartLeft = super.getLeft();
        viewHight = super.getHeight();
        viewWidth = super.getWidth();

        TEXT_SIZE = viewHight / 20.0f;
        lable_size = viewHight / 16.0f;


        start_x = viewStartLeft + (viewWidth / 10.0f) * 1.5f + lable_size;
        start_y = viewStartTop + (viewHight / 10.0f) * 1.0f + lable_size;
        end_x = viewStartLeft + (viewWidth / 10.0f) * 9.0f - lable_size;
        end_y = viewStartTop + (viewHight / 10.0f) * 8.5f - lable_size;
    }

    /**
     * 绘制数据
     *
     * @param canvas
     */
    private void DrawData(Canvas canvas) {

    }

    /**
     * 绘制背景
     *
     * @param canvas
     */
    private void DrawBackGround(Canvas canvas) {

        Draw_Bkg(canvas);
        Draw_X(canvas);
        Draw_Y(canvas);


    }

    /**
     * 绘制数据
     *
     * @param canvas
     */
    private void Draw_Data(Canvas canvas) {

        int temp;
        Paint data_paint = new Paint();
        data_paint.setColor(DATA_ABOVE_COLOR);
        data_paint.setStrokeWidth(2);
        data_paint.setAntiAlias(true);
        float per_x = (end_x - start_x) / ((float)TheOtherParameter.PHASE_COUNT + 1.0f);
        float per_y = (end_y - start_y) / SHOW_TAB;
        int Phase_Offst_Temp = PHASE / 6;
        int offset = 0;
        Paint paint_data = new Paint();

        if (Phase_Offst_Temp > 0) {
            /*左移*/
            offset =TheOtherParameter.PHASE_COUNT - Phase_Offst_Temp;

        } else {
            /*右移*/
            offset = -Phase_Offst_Temp;

        }

        /********Offset - 60****************/
        for (int i = offset; i <TheOtherParameter.PHASE_COUNT; i++) {
            temp = DataResult[i];
            temp /= 3;
            if (temp >= SHOW_TAB) {
                temp = SHOW_TAB;
            }

            if ((temp > THRESHOLD)) {
                canvas.drawLine(
                        start_x + ((i - offset) + 1) * per_x
                        , start_y + ((end_y - start_y) - (float) temp * per_y) < start_y ? start_y : start_y + (end_y - start_y) - (float) temp * per_y
                        , start_x + ((i - offset) + 1) * per_x
                        , end_y - 1
                        , data_paint
                );
            }

        }

        for (int i = 0; i < offset; i++) {
            temp = DataResult[i];
            temp /= 3;
            if (temp >= SHOW_TAB) {
                temp = SHOW_TAB;
            }


            if ((temp > THRESHOLD)) {
                canvas.drawLine(
                        start_x + ((TheOtherParameter.PHASE_COUNT - offset + i) + 1) * per_x
                        , start_y + ((end_y - start_y) - (float) temp * per_y) < start_y ? start_y : start_y + (end_y - start_y) - (float) temp * per_y
                        , start_x + ((TheOtherParameter.PHASE_COUNT - offset + i) + 1) * per_x
                        , end_y - 1
                        , data_paint
                );

            }
        }
    }

    /**
     * 绘制底景
     *
     * @param canvas
     */
    private void Draw_Bkg(Canvas canvas) {


        Paint paint_bkg = new Paint();
        paint_bkg.setColor(DATA_BKG_COLOR);
        canvas.drawRect(start_x + 1, start_y + 1, end_x - 1, end_y - 1, paint_bkg);

        Paint paint_grid = new Paint();
        paint_grid.setColor(AXIS_COLOR);
        paint_grid.setStrokeWidth(1);
        draw_squre(start_x, start_y, end_x - start_x, end_y - start_y, paint_grid, canvas);


    }

    /**
     * 绘制X以及坐标轴
     *
     * @param canvas
     */
    private void Draw_X(Canvas canvas) {


        Paint paint_Grid = new Paint();
        paint_Grid.setColor(GRID_LINE_COLOR);
        paint_Grid.setStrokeWidth(1);
        paint_Grid.setAntiAlias(true);


        Paint paint_text = new Paint();
        paint_text.setColor(AXIS_COLOR);
        paint_text.setStrokeWidth(1);
        paint_text.setAntiAlias(true);
        paint_text.setTextSize(TEXT_SIZE);
        //   canvas.drawText("图谱:Q(φ)", start_x, start_y - getTextHeight("图谱:Q(φ)", TEXT_SIZE) / 2.0f, paint_text);

        float per = (end_y - start_y) / 4.0f;
        for (int i = 0; i < 3; i++) {
            canvas.drawLine(start_x + 1, start_y + per * (i + 1), end_x - 1, start_y + per * (i + 1), paint_Grid);

        }
        float per_y = per / 5.0f;
        int PER_TAB = SHOW_TAB / 20;
        for (int i = 0; i < 21; i++) {
            if (i % 5 == 0) {
                canvas.drawLine(start_x - 15.0f, start_y + i * per_y, start_x, start_y + i * per_y, paint_text);

                canvas.drawText(String.format("%d", (20 - i) * PER_TAB + SHOW_OFFSET),
                        start_x - 20.0f - getTextWidth(String.format("%d", (20 - i) * PER_TAB + SHOW_OFFSET), TEXT_SIZE),
                        start_y + i * per_y + getTextHeight(String.format("%d", (20 - i) * PER_TAB + SHOW_OFFSET), TEXT_SIZE) / 4.0f
                        , paint_text);
            } else {
                canvas.drawLine(start_x - 7.05f, start_y + i * per_y, start_x, start_y + i * per_y, paint_text);
            }
        }
    }

    /**
     * 绘制Y以及坐标轴
     *
     * @param canvas
     */
    private void Draw_Y(Canvas canvas) {


        Paint paint_Grid = new Paint();
        paint_Grid.setColor(GRID_LINE_COLOR);
        paint_Grid.setStrokeWidth(1);
        paint_Grid.setAntiAlias(true);


        Paint paint_text = new Paint();
        paint_text.setColor(AXIS_COLOR);
        paint_text.setStrokeWidth(1);
        paint_text.setAntiAlias(true);
        paint_text.setTextSize(TEXT_SIZE);

        float per = (end_x - start_x) / 4.0f;
        float per_x = per / 5.0f;
        int j = 0;
        for (int i = 0; i < 3; i++) {
            canvas.drawLine(start_x + (i + 1) * per, start_y + 1, start_x + (i + 1) * per, end_y - 1, paint_Grid);
            for (j = 0; j < 5; j++) {
                if (j == 0) {
                    canvas.drawLine(start_x + (i + 1) * per + j * per_x, end_y, start_x + (i + 1) * per + j * per_x, end_y + 15.0f, paint_text);
                    canvas.drawText(String.format("%d", (i + 1) * 90),
                            start_x + (i + 1) * per - getTextWidth(String.format("%d", (i + 1) * 90), TEXT_SIZE) / 2.0f
                            , (float) (end_y + getTextHeight(String.format("%d", (i + 1) * 90), TEXT_SIZE) * 1.5)
                            , paint_text
                    );
                } else {
                    canvas.drawLine(start_x + (i + 1) * per + j * per_x, end_y, start_x + (i + 1) * per + j * per_x, end_y + 7.5f, paint_text);
                }

            }
        }
        for (j = 0; j < 5; j++) {
            if (j == 0) {
                canvas.drawLine(start_x + j * per_x, end_y, start_x + j * per_x, end_y + 15.0f, paint_text);
                canvas.drawText("0",
                        start_x - getTextWidth("0", TEXT_SIZE) / 2.0f
                        , (float) (end_y + getTextHeight("0", TEXT_SIZE) * 1.5)
                        , paint_text);
            } else {
                canvas.drawLine(start_x + j * per_x, end_y, start_x + j * per_x, end_y + 7.5f, paint_text);
            }

        }
        canvas.drawLine(end_x, end_y, end_x, end_y + 15.0f, paint_text);
        canvas.drawText("360",
                end_x - getTextWidth("360", TEXT_SIZE) / 2.0f
                , (float) (end_y + getTextHeight("360", TEXT_SIZE) * 1.5)
                , paint_text);


    }


    /**
     * 计算Qfai图谱
     *
     * @param Data
     */
    public void Compute_Qfai(List<P_Data> Data) {
        if (m_objTempData == null) {
            m_objTempData = new ArrayList<P_Data>();
        }
        for (int i = 0; i <TheOtherParameter.PHASE_COUNT; i++) {
            DataResult[i] = 0;
        }
        /*添加数据*/
        byte[] temp;
        m_objTempData.addAll(Data);
        int temp_size = m_objTempData.size();
        /*统计一秒的Qfai图谱*/
        if (m_objTempData.size() >= 50) {
            for (int i = 50; i < temp_size; i++) {
                m_objTempData.remove(0);
            }

            for (int i = 0; i < m_objTempData.size(); i++) {
                temp = m_objTempData.get(i).getData();
                for (int j = 0; j <TheOtherParameter.PHASE_COUNT; j++) {
                    if (((int) temp[j] & 0xff) >= DataResult[j]) {
                        DataResult[j] = (int) temp[j] & 0xff;
                    }
                }
            }
            invalidate();
        }
    }


    /******************设置方法********************/
    /**
     * 设置背景颜色
     *
     * @param color RGB颜色
     */
    public void SetBackGroundColor(int color) {
        BKG_COLOR = color;
    }

    /**
     * 设置数据显示背景
     *
     * @param color RGB颜色
     */
    public void SetDataBackGroundColor(int color) {
        DATA_BKG_COLOR = color;
    }

    /**
     * 设置数据显示前景色
     *
     * @param color RGB颜色
     */
    public void SetDataAboveColor(int color) {
        DATA_ABOVE_COLOR = color;
    }

    /**
     * 设置栅格线条颜色
     *
     * @param color RGB颜色
     */
    public void SetGridLineColor(int color) {
        GRID_LINE_COLOR = color;
    }

    /**
     * 设置坐标轴颜色
     *
     * @param color RGB颜色
     */
    public void SetAxisColor(int color) {
        AXIS_COLOR = color;
    }

    /**
     * 设置显示范围
     *
     * @param range 1-》0-20；2-》0-40；3-》0-60；4-》0-80；
     */
    public void SetShowRange(int range) {
        switch (range) {
            case 1:
                SHOW_TAB = 20;
                break;
            case 2:
                SHOW_TAB = 40;
                break;
            case 3:
                SHOW_TAB = 60;
                break;
            case 4:
                SHOW_TAB = 80;
                break;
            default:
                SHOW_TAB = 80;
                break;
        }
        invalidate();

    }


    /**
     * 设置数据
     */
    public void SetData(List<Integer> data) {
        Data = data;
        /*更新数据*/
        invalidate();

    }

    /*绘制方法*/

    /**
     * 画矩形
     *
     * @param x
     * @param y
     * @param whith
     * @param hight
     * @param paint
     * @param canvas
     */
    private void draw_squre(float x, float y, float whith, float hight, Paint paint, Canvas canvas) {
        /*top*/
        canvas.drawLine(x, y, x + whith, y, paint);
        /*bottom*/
        canvas.drawLine(x, y + hight, x + whith, y + hight, paint);
        /*left*/
        canvas.drawLine(x, y, x, y + hight, paint);
        /*right*/
        canvas.drawLine(x + whith, y, x + whith, y + hight, paint);


    }
    /*页面计算方法*/

    /**
     * 计算字体的占用宽度
     *
     * @param text     字符串
     * @param textsize 字体大小
     * @return
     */
    private float getTextWidth(String text, float textsize) {
        if (text == null || text.length() <= 0) {
            return 0;
        }
        Paint paint = new Paint();
        paint.setTextSize(textsize);
        return paint.measureText(text);
    }

    /**
     * 计算文本的占用高度
     *
     * @param text     显示的字符串
     * @param textsize 显示的字体大小
     * @return
     */
    private float getTextHeight(String text, float textsize) {
        Paint paint = new Paint();
        paint.setTextSize(textsize);
        Paint.FontMetrics fm = paint.getFontMetrics();
        return fm.descent - fm.ascent;
    }


    @Override
    public boolean onTouchEvent(MotionEvent event) {
        switch (event.getAction()) {
            case MotionEvent.ACTION_DOWN:
                //捕获到单指按下，或者说捕获到第一个指头按下
                touch_start_X = event.getX();
                touch_start_Y = event.getY();

                /*****记录开始滑动以前的值******/
                m_ntempPhase = PHASE;
                m_ntempThreshold = THRESHOLD;
                m_ntempShowTab = SHOW_TAB;
                SHOW_TAB_CAN_TAUCHED = true;

                break;

            case MotionEvent.ACTION_MOVE:
                touch_end_X = event.getX();
                touch_end_Y = event.getY();
                /*判断是否超出视图区域*/
                if ((touch_end_X >= (viewStartLeft + viewWidth)) || (touch_end_X <= viewStartLeft)) {
                    /*左右边界超限*/
                    return true;
                }
                if ((touch_end_Y <= viewStartTop) || (touch_end_Y >= (viewStartTop + viewHight))) {
                    /*上下边界超限*/
                    SHOW_TAB_Touch_Proc();
                    return true;
                }
                if (Math.abs(touch_end_X - touch_start_X) >= Math.abs(touch_end_Y - touch_start_Y)) {
                    /*上下屏幕*/
                    Touched_Top_Bottom_Screen();
                } else {
                    /*左右屏幕*/
                    Touched_Left_Right_Screen();

                }

                break;
            /*手指抬起*/
            case MotionEvent.ACTION_UP:
                //捕获到最后一个指头离开
                touch_end_X = event.getX();
                touch_end_Y = event.getY();
                /*判断是否超出视图区域*/
                if ((touch_end_X >= (viewStartLeft + viewWidth)) || (touch_end_X <= viewStartLeft)) {
                    /*左右边界超限*/
                    SHOW_TAB_CAN_TAUCHED = false;
                    return true;
                }
                if ((touch_end_Y <= viewStartTop) || (touch_end_Y >= (viewStartTop + viewHight))) {
                    /*上下边界超限*/
                    SHOW_TAB_CAN_TAUCHED = false;
                    return true;
                }

                /*******显示量程调节*******/

                SHOW_TAB_Touch_Proc();
        }
        return true;
    }

    private void SHOW_TAB_Touch_Proc() {

        if (!SHOW_TAB_CAN_TAUCHED) {
            return;
        }
        if ((Math.abs(touch_end_X - touch_start_X) <= Math.abs(touch_end_Y - touch_start_Y))) {
            /*左屏幕*/
            if (touch_start_X >= (viewStartLeft + viewWidth / 2.0f)) {
                if ((touch_end_Y - touch_start_Y) >= 10.0f) {
                    /*下滑*/
                    SHOW_TAB -= 20;
                    SHOW_TAB = SHOW_TAB <= 20 ? 20 : SHOW_TAB;
                    THRESHOLD = THRESHOLD >= SHOW_TAB ? SHOW_TAB : THRESHOLD;
                    Touch_Notifier();
                } else if ((touch_end_Y - touch_start_Y) <= -10.0f) {
                    /*上滑动*/
                    SHOW_TAB += 20;
                    SHOW_TAB = SHOW_TAB >= 80 ? 80 : SHOW_TAB;
                    THRESHOLD = THRESHOLD >= SHOW_TAB ? SHOW_TAB : THRESHOLD;
                    Touch_Notifier();
                }
            }
        }
        SHOW_TAB_CAN_TAUCHED = false;
    }

    /**
     * 触摸事件通知
     */
    private void Touch_Notifier() {

        if (listenr != null) {
            listenr.PrpsTouchEvent(new PrpsEvent(SHOW_TAB, PHASE, THRESHOLD));
        }
        invalidate();
    }

    /**
     * 左右屏幕事件
     */
    private void Touched_Left_Right_Screen() {
        if (touch_start_X >= (viewStartLeft + viewWidth / 2.0f)) {
            /*右半屏幕*/
            /****不考虑，单次滑动有效*****/
        } else {
            /*左半屏幕*/

            /*显示阈值调节*/
            float temp_per = viewHight / 6.0f;
            THRESHOLD = (int) (m_ntempThreshold - (int) ((touch_end_Y - touch_start_Y) / temp_per));
            /*判断是否超出显示量程*/
            THRESHOLD = THRESHOLD >= SHOW_TAB ? SHOW_TAB : THRESHOLD;
            THRESHOLD = THRESHOLD <= 0 ? 0 : THRESHOLD;
            Touch_Notifier();
        }


    }

    /**
     * 上下屏幕事件
     */
    private void Touched_Top_Bottom_Screen() {
        if (Math.abs(touch_end_X - touch_start_X) < 5.0f) {
            return;
        }
        if (touch_start_Y >= (viewStartTop + viewHight / 2.0f)) {
            /*下半屏幕*/
            /*相位调节*/
            float temp_per = viewWidth / 6.0f;
            PHASE = (int) (m_ntempPhase + (int) ((touch_end_X - touch_start_X) / temp_per) * 6);
            /*判断是否超出范围*/
            PHASE = PHASE <= -180 ? -180 : PHASE;
            PHASE = PHASE >= 180 ? 180 : PHASE;
            Touch_Notifier();
        } else {
            /*上半屏幕不使用*/

        }

    }


    /**
     * 绘制触摸事件提示
     *
     * @param canvas
     */
    private void Draw_Information(Canvas canvas) {


        Paint paint_Text = new Paint();
        paint_Text.setColor(Color_set.INFORMATION_COLOR);
        paint_Text.setTextSize(lable_size);
        paint_Text.setAntiAlias(true);

        /*二、相位*/
        String text2 = String.format("相位(%d°)", PHASE);
        canvas.drawText(text2, viewStartLeft + viewWidth / 2.0f - getTextWidth(text2, lable_size) / 2.0f
                , viewStartTop + viewHight - getTextHeight(text2, lable_size) / 2.0f
                , paint_Text
        );
        /*************＞＞＞************/
        paint_Text.setColor(COLOR_1);
        canvas.drawText("＞", viewStartLeft + viewWidth / 2.0f + getTextWidth(text2, lable_size) / 2.0f + TEXT_SIZE * 1
                , viewStartTop + viewHight - getTextHeight(text2, lable_size) / 2.0f
                , paint_Text
        );

        paint_Text.setColor(COLOR_2);
        canvas.drawText("＞", viewStartLeft + viewWidth / 2.0f + getTextWidth(text2, lable_size) / 2.0f + TEXT_SIZE * 2
                , viewStartTop + viewHight - getTextHeight(text2, lable_size) / 2.0f
                , paint_Text
        );
        paint_Text.setColor(COLOR_3);
        canvas.drawText("＞", viewStartLeft + viewWidth / 2.0f + getTextWidth(text2, lable_size) / 2.0f + TEXT_SIZE * 3
                , viewStartTop + viewHight - getTextHeight(text2, lable_size) / 2.0f
                , paint_Text
        );
        /*************＜＜＜************/
        paint_Text.setColor(COLOR_1);
        canvas.drawText("＜", viewStartLeft + viewWidth / 2.0f - getTextWidth(text2, lable_size) / 2.0f - TEXT_SIZE * 2
                , viewStartTop + viewHight - getTextHeight(text2, lable_size) / 2.0f
                , paint_Text
        );
        paint_Text.setColor(COLOR_2);
        canvas.drawText("＜", viewStartLeft + viewWidth / 2.0f - getTextWidth(text2, lable_size) / 2.0f - TEXT_SIZE * 3
                , viewStartTop + viewHight - getTextHeight(text2, lable_size) / 2.0f
                , paint_Text
        );
        paint_Text.setColor(COLOR_3);
        canvas.drawText("＜", viewStartLeft + viewWidth / 2.0f - getTextWidth(text2, lable_size) / 2.0f - TEXT_SIZE * 4
                , viewStartTop + viewHight - getTextHeight(text2, lable_size) / 2.0f
                , paint_Text
        );
        /*三、显示范围（量程）*/
        paint_Text.setColor(Color_set.INFORMATION_COLOR);
        String text4 = String.format("量程(%d~%d%s)", SHOW_OFFSET, SHOW_TAB + SHOW_OFFSET, Format);
        String text3 = String.format("阈值(%d%s)", THRESHOLD + SHOW_OFFSET, Format);

        Information_Drawer.Draw_Left_Tips(canvas, viewStartLeft, viewStartTop, viewHight, text3, lable_size);


        Information_Drawer.Draw_Right_Tips(canvas, viewStartLeft + viewWidth, viewStartTop, viewHight, text4, lable_size);


    }

    /**
     * 绘制显示阈值三角形
     *
     * @param canvas
     */
    private void Draw_TriCyle(Canvas canvas) {
        float tri_start_x, tri_start_y;
        tri_start_x = start_x - 1;
        tri_start_y = end_y - (end_y - start_y) / (float) SHOW_TAB * (float) THRESHOLD;

        Path tri_path = new Path();
        tri_path.moveTo(tri_start_x, tri_start_y);
        tri_path.lineTo(tri_start_x - TEXT_SIZE, tri_start_y - TEXT_SIZE / 2.0F);
        tri_path.lineTo(tri_start_x - TEXT_SIZE, tri_start_y + TEXT_SIZE / 2.0F);
        tri_path.close();
        Paint tri_paint = new Paint();
        tri_paint.setStyle(Paint.Style.FILL);
        tri_paint.setColor(Color.argb(0x80, 0xff, 0x00, 0x00));
        canvas.drawPath(tri_path, tri_paint);

    }

    /**
     * 绘制图表标题
     *
     * @param canvas
     */
    private void Draw_Title(Canvas canvas) {
        Information_Drawer.Draw_Title(canvas, viewStartLeft, viewStartTop, viewWidth, viewHight, "Qφ", lable_size);


    }

    public void SetShowOffset(int Offset) {
        SHOW_OFFSET = Offset;
        invalidate();
    }

    public void seteventlistenr(PrpsListener prpsListener) {
        this.listenr = prpsListener;
    }

    /**
     * 设置图像信息
     *
     * @param phase     偏移相位
     * @param tab       量程
     * @param threshold 显示阈值
     */
    public void set_information(int phase, int tab, int threshold) {
        this.PHASE = phase;
        this.SHOW_TAB = tab;
        this.THRESHOLD = threshold;
        invalidate();
    }

    /**
     * 清除Qfai视图
     */
    public void Clear_Qfai() {
        for (int i = 0; i <TheOtherParameter.PHASE_COUNT; i++) {
            DataResult[i] = 0;
        }
        invalidate();
    }

    public void SetFormat(String format) {
        this.Format = format;
        invalidate();
    }

    public void setthreshold(int threshold) {
        this.THRESHOLD = threshold;
        invalidate();
    }
}
